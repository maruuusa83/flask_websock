<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
	<link rel="stylesheet" href="static/css/min/bootmetro.min.css" />
	<link rel="stylesheet" href="static/css/min/bootmetro-responsive.min.css" />
	<link rel="stylesheet" href="static/css/min/bootmetro-icons.min.css" />
	<title></title>
</head>
<body>
	<div class="navbar">
		<div class="navbar-inner">
			<ul class="nav">
				<li><a class="brand" href="#">mi-7.tk</a></li>
				<li><a data-toggle="modal" href="#myModal">history</a></li>
			</ul>
		</div>

		<div id="myModal" class="modal message hide fade">
			<div class="modal-header">
				<h3>History</h3>
			</div>
			<div class="modal-body">
				<p><strong>v1.2.0</strong> コテハンをつけることができるようになりました <small>at 2014.11.26</small></p>
				<p><strong>v1.1.0</strong> 現在のアクセス人数が表示できるようになりました <small>at 2014.11.26</small></p>
				<p><strong>v1.0.1</strong> historyボタンきれいにしました <small>at 2014.11.26</small></p>
				<p><strong>v1.0.0</strong> とりあえず公開 <small>at 2014.11.26</small></p>
			</div>
			<div class="modal-footer">
				<button class="btn" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
    <div class="row">
		<div class="span2"></div>
		<div class="span8">
			<div class="page-header">
				<h1>Bulletin Board <small>for 7th mi</small></h1>
			</div>

			<p>Now Access : <span id="numOfAccess"></span></p>
			<div>
				<form onsubmit="return false;">
					<input class="span4" name="send_input" id="send_input" placeholder="コメント" />
					<input class="span2" name="send_name" id="send_name" placeholder="となりのナナミさん" />
					<input class="span1" type="submit" value="send" onclick="send_data()" />
				</form>
			</div>
			<div id="view"></div>
		</div>
		<div class="span2"></div>
    </div>

	<script type="text/javascript" src="static/js/jquery.min.js"></script>
	<script type="text/javascript" src="static/js/min/bootmetro.min.js"></script>
	<script type="text/javascript" src="static/js/min/bootstrap.min.js"></script>
	<script type="text/javascript" src="static/js/md5.js"></script>
	<script type="text/javascript">
var ws = new WebSocket("ws://nado.oknctict.tk:8000/echo");
ws.onmessage = function(e){
	var recvData = jQuery.parseJSON(e.data);

	if (recvData.type == "msg"){
		str = "<blockquote style=\"width:100%;\">" + recvData.data + "</blockquote>";
		$("#view").prepend($(str));
	}
	else if (recvData.type == "userNum"){
		$("#numOfAccess").html(recvData.data);
	}
};

function send_data(){
	var str = $("#send_input").val();
	if ($("#send_name").val() != ""){
		splited_name = $("#send_name").val().split("#");
		str += "<small>" + splited_name[0];
		if (splited_name.length > 1){
			str += " @" + CybozuLabs.MD5.calc(splited_name[1]);
		}
		str += "</small>";
	}
	ws.send(str);
	$("#send_input").val("");
};
	</script>
</body>
</html>
